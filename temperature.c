/***************************************************************************
*
* Copyright (c) 2015
* Z-Wave Designs Ltd.
* http://www.zwavedesigns.com
* All Rights Reserved
*
*---------------------------------------------------------------------------
*
* Description: Temperature source file
*
* Author: Phil Smith - Z-Wave Designs Ltd.
*
* Last Changed By:  Phil
* Revision:         0.01
* Last Changed:     12/01/15
*
****************************************************************************/
#include <ZW_sysdefs.h>
#include <ZW_tx_mutex.h>
#include <ZW_adcdriv_api.h>

// lookup table for A/D value to Temperature
static code WORD TempTable[] =
{
1,2,3,4,5,6,7,8,9,10,  // 1
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,   //2
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //3
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //4
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,    //5     
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
1,2,3,4,5,6,														// 256

1,2,3,4,5,6,7,8,9,10,  // 1
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,   //2
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //3
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //4
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,    //5     
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
1,2,3,4,5,6,													//512

1,2,3,4,5,6,7,8,9,10,  // 1
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,   //2
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //3
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //4
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,    //5     
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
1,2,3,4,5,6,															// 768

1,2,3,4,5,6,7,8,9,10,  // 1
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,   //2
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //3
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //4
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,    //5     
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
1,2,3,4,5,6,

																					// 1024
1,2,3,4,5,6,7,8,9,10,  // 1
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,   //2
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,0,0,0,1,1,1,						//  **************** ZERO C *************************
1,2,2,2,2,3,3,3,4,4,	
	
4,4,3,4,5,6,7,8,9,10,   //3
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //4
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,    //5     
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
1,2,3,4,5,6,												// 1024 256      1280

1,2,3,4,5,6,7,8,9,10,  // 1
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,   //2
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //3
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //4
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,    //5     
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
1,2,3,4,5,6,																// 1536

1,2,3,4,5,6,7,8,9,10,  // 1
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,   //2
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //3
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //4
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,    //5     
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
1,2,3,4,5,6,															// 1792

1,2,3,4,5,6,7,8,9,10,  // 1
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,   //2
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //3
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //4
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,    //5     
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
1,2,3,4,5,6,
																													// 2048
0x208,0x208,0x208,0x208,0x208,0x207,0x207,0x207,0x207,0x207,
0x206,0x206,0x206,0x206,0x206,0x205,0x205,0x205,0x205,0x205,
0x204,0x204,0x204,0x204,0x204,0x203,0x203,0x203,0x203,0x203,
0x202,0x202,0x202,0x202,0x201,0x200,0x200,0x200,0x200,0x200,
0x199,0x199,0x199,0x199,0x199,0x198,0x198,0x198,0x198,0x198,	
0x197,0x197,0x197,0x197,0x197,0x196,0x196,0x196,0x196,0x196, //2
0x195,0x195,0x195,0x195,0x195,0x194,0x194,0x194,0x194,0x194,
0x193,0x193,0x193,0x193,0x193,0x192,0x192,0x192,0x192,0x192, //2
0x191,0x191,0x191,0x191,0x191,0x190,0x190,0x190,0x190,0x190,
0x189,0x189,0x189,0x189,0x189,0x188,0x188,0x188,0x188,0x188,	
0x187,0x187,0x187,0x187,0x187,0x186,0x186,0x186,0x186,0x186, //2
0x185,0x185,0x185,0x185,0x185,0x184,0x184,0x184,0x184,0x184,
0x183,0x183,0x183,0x183,0x183,0x182,0x182,0x182,0x182,0x182, //2
0x181,0x181,0x181,0x181,0x181,0x180,0x180,0x180,0x180,0x180,

0x179,0x179,0x179,0x179,0x179,0x178,0x178,0x178,0x178,0x178,	
0x177,0x177,0x177,0x177,0x177,0x176,0x176,0x176,0x176,0x176, //2
0x175,0x175,0x175,0x175,0x175,0x174,0x174,0x174,0x174,0x174,
0x173,0x173,0x173,0x173,0x173,0x172,0x172,0x172,0x172,0x172, //2
0x171,0x171,0x171,0x171,0x171,0x170,0x170,0x170,0x170,0x170,
0x169,0x169,0x169,0x169,0x169,0x168,0x168,0x168,0x168,0x168,	
0x167,0x167,0x167,0x167,0x167,0x166,0x166,0x166,0x166,0x166, //2
0x165,0x165,0x165,0x165,0x165,0x164,0x164,0x164,0x164,0x164,
0x163,0x163,0x163,0x163,0x163,0x162,0x162,0x162,0x162,0x162, //2
0x161,0x161,0x161,0x161,0x161,0x160,0x160,0x160,0x160,0x160,

1,2,3,4,5,6,7,8,9,10,	
1,2,3,4,5,6,																		// 2304

1,2,3,4,5,6,7,8,9,10,  // 1
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,   //2
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //3
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //4
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,    //5     
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
1,2,3,4,5,6,                           // 2560

1,2,3,4,5,6,7,8,9,10,  // 1
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,   //2
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //3
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //4
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,    //5     
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
1,2,3,4,5,6,                          // 2816
1,2,3,4,5,6,7,8,9,10,  // 1
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,   //2
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //3
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //4
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,    //5     
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
1,2,3,4,5,6,                      // 3072
	// 3072
1,2,3,4,5,6,7,8,9,10,  // 1
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,   //2
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //3
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //4
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,    //5     
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
1,2,3,4,5,6,                      // 3328

1,2,3,4,5,6,7,8,9,10,  // 1
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,   //2
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //3
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //4
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,    //5     
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
1,2,3,4,5,6,                     //3584

1,2,3,4,5,6,7,8,9,10,  // 1
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,   //2
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //3
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //4
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,    //5     
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
1,2,3,4,5,6,                 // 3840

1,2,3,4,5,6,7,8,9,10,  // 1
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,   //2
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //3
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
	
1,2,3,4,5,6,7,8,9,10,   //4
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	

1,2,3,4,5,6,7,8,9,10,    //5     
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,
1,2,3,4,5,6,7,8,9,10,	
1,2,3,4,5,6                   // 4096
};



WORD DoTemp()
{
	WORD result;
	ZW_ADC_power_enable(TRUE);  // switch on the A/D
	ZW_ADC_pin_select(ADC_PIN_2);  // Using ADC1
	// Initialisation of the Analogue to Digital Convertor to ADC1
	ZW_ADC_init(ADC_SINGLE_MODE, ADC_REF_U_VDD, ADC_REF_L_VSS,ADC_PIN_2 );
  ZW_ADC_resolution_set(ADC_12_BIT);
	ZW_ADC_enable(TRUE);
	do
	{
		result=ZW_ADC_result_get(); // wait till complete
	}
	while (result==0xFFFF);
	ZW_ADC_enable(FALSE);
  ZW_ADC_power_enable(FALSE); // turn it all off
	return result;
	//return TempTable[(WORD)result];
}

WORD Get_Temp(WORD Val)
{
	return TempTable[(WORD) Val];
}
